# 기술 개요: Excel Map Editor (엑셀 지도 편집기)

이 문서는 "Excel Map Editor" 프로젝트의 기술적 개요를 제공하며, 시니어 개발자에게 아키텍처 및 주요 구현 세부 사항을 설명하는 데 도움을 주기 위해 작성되었습니다.

## 핵심 아키텍처 및 기술 스택
- **언어**: Python 3.x
- **GUI 프레임워크**: `tkinter` 및 `ttkbootstrap` (모던한 UI 테마 적용).
- **데이터 처리**: `pandas`를 사용한 엑셀 파싱 및 데이터 조작.
- **이미지 처리**: `PIL` (Pillow)을 사용하여 정적 지도 이미지 위에 커스텀 마커와 라벨 렌더링.
- **API 연동**: Vworld API (국가공간정보포털)를 활용하여 지오코딩, 장소 검색 및 정적 지도 타일 서비스 연동.

## 주요 기술적 특징

### 1. 견고한 지오코딩 엔진 (`_smart_search_orchestrator`)
단순한 검색을 넘어 다단계 폴백(Fallback) 로직을 구현했습니다:
1. **도로명/지번 주소 검색**: 공식 주소 조회를 우선시합니다.
2. **장소/키워드 검색**: 건물명이나 랜드마크 검색을 위한 보조 수단입니다.
3. **재귀적 토큰화**: 전체 주소 검색 실패 시, 유효한 좌표를 찾을 때까지 주소의 앞부분 토큰을 하나씩 제거하며(예: "서울특별시 강남구..." -> "강남구...") 재검색을 시도합니다.

### 2. 지능형 뷰포트 계산 (`calculate_zoom_and_center`)
고정된 줌 레벨 대신, 선택된 모든 핀의 바운딩 박스를 기반으로 최적의 줌 레벨과 중심점을 계산합니다. **Web Mercator Projection** 수학 공식(`latlon_to_pixel`)을 사용하며, 라벨과 핀이 화면 가장자리에서 잘리지 않도록 동적 패딩(Padding)을 포함합니다.

### 3. 커스텀 마커 렌더링
단순 아이콘 사용이 아닌, RGBA 레이어로 마커를 직접 렌더링합니다:
- **Shadow & Halo**: 프리미엄 느낌을 주기 위해 가우시안 형태의 원형 그림자를 프로그래밍 방식으로 표현했습니다.
- **색상 코드**: 엑셀 데이터의 타입에 따라 핀 색상을 동적으로 지정합니다.
- **라벨 방향 제어**: 3x3 그리드 로직을 적용해 사용자가 라벨 위치(↖, ↑, ↗ 등)를 오프셋으로 조절하여 핀끼리 겹치는 현상을 방지할 수 있습니다.

### 4. 멀티스레딩 기반 UI 비응답 방지 (`Threading`)
- **문제점**: 대량의 엑셀 데이터를 처리하거나 네트워크 API 호출 시 GUI가 멈추는(Freezing) 현상이 발생할 수 있습니다.
- **해결책**: 엑셀 로드 및 지오코딩 프로세스를 백그라운드 스레드로 분리하여, 데이터 처리 중에도 사용자가 지도를 드래그하거나 다른 조작을 할 수 있도록 UI 반응성을 확보했습니다.

### 5. 효율적인 지오코딩 캐싱 로직 (`Geocoding Cache`)
- **최적화**: 동일한 주소에 대한 반복적인 API 호출을 방지하기 위해 인메모리 캐시 시스템을 도입했습니다. 이는 API 쿼터(할당량)를 절약하고, 중복 데이터가 많은 엑셀 파일 처리 속도를 비약적으로 향상시킵니다.

## 보안 개선 사항 (Best Practices)

### 비밀 정보 관리 (Secret Management)
- **문제점**: 초기 버전에는 Vworld API 키가 코드 내에 하드코딩되어 있었습니다.
- **해결책**: `config.json` 기반의 로더를 구현하여 코드와 설정(비밀 정보)을 분리했습니다.
- **Git Hygiene**: `.gitignore`를 설정하여 `config.json`(비밀번호류), `venv/`(종속성), `__pycache__` 등이 레포지토리에 커밋되지 않도록 차단했습니다. 이는 **코드와 설정의 분리**라는 표준 보안 원칙을 준수합니다.

## 향후 확장 제안 (토론 주제)
- **비동기 IO**: 대량의 배치 작업 시 UI 프리징 현상을 방지하기 위해 API 호출을 `threading`이나 `asyncio`로 전환.
- **캐싱 레이어**: API 쿼터 사용량을 최소화하기 위해 지오코딩 결과를 SQLite나 파일 기반으로 로컬 캐싱.
- **벡터 타일링**: 정적 지도(Raster) 방식에서 벗어나 벡터 기반 지도 엔진(Mapbox 등) 또는 WebView를 통한 Leaflet 연동으로 더욱 매끄러운 사용자 경험 제공.
